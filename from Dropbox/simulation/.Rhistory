abs(cor(result_ad$A) - FC_true_ii)
dd=5
dur <- durations[dd]
print(paste0('~~~~~~ duration: ',dur,' ~~~~~~~~~'))
result_ad <- templateICA(BOLD = xifti_ii,
template = template,
scale = 'none',
Q2 = 0,
epsilon = 1e-6,
brainstructures = c('left','right'),
verbose=TRUE,
method_FC = alg,
reduce_dim = FALSE,
time_inds = 1:dur)
(MSE_TC_iad <- mean((result_ad$A - TC_ii[1:dur,])^2))
rowMeans(FC_MSE_min)
abs(cor(result_ad$A) - FC_true_ii)
lines(1:dur, result_ad$A[,1], col='turquoise')
dd=6
dur <- durations[dd]
print(paste0('~~~~~~ duration: ',dur,' ~~~~~~~~~'))
print(alg <- algos[aa])
result_ad <- templateICA(BOLD = xifti_ii,
template = template,
scale = 'none',
Q2 = 0,
epsilon = 1e-6,
brainstructures = c('left','right'),
verbose=TRUE,
method_FC = alg,
reduce_dim = FALSE,
time_inds = 1:dur)
MAE_true <- apply(err_true, 1:4, median)
save(MSE_true, MSE_prior, MAE_true, MSE_TC, file = 'results/long_duration/MSE.RData')
(MSE_TC_iad <- mean((result_ad$A - TC_ii[1:dur,])^2))
abs(cor(result_ad$A) - FC_true_ii)
dim(result_ad$A)
dim(TC_ii[1:dur,])
plot(result_ad$A[1:100,1], type='l')
lines(TC_ii[1:100,1], col='pink')
sqrt(mean((result_ad$A[1:100,1] - TC_ii[1:100,1])^2))
mean(TC_ii)
abline(h=0)
mean(abs(TC_ii))
sqrt(mean(abs(result_ad$A[1:100,1] - TC_ii[1:100,1])))
(mean(abs(result_ad$A[1:100,1] - TC_ii[1:100,1])))
plot(abs(result_ad$A[1:100,1] - TC_ii[1:100,1]), type='l')
par(mar=c(2,2,2,2))
plot(abs(result_ad$A[1:100,1] - TC_ii[1:100,1]), type='l')
abline(h=mean(abs(result_ad$A[1:100,1] - TC_ii[1:100,1])))
plot(result_ad$A[1:100,1], type='l')
par(mar=c(2,2,2,2))
plot(result_ad$A[1:100,1], type='l')
lines(TC_ii[1:100,1], col='pink')
plot(abs(TC_ii[1:100,1]), type='l')
abline(mean(abs(TC_ii[1:100,1])))
abline(h=mean(abs(TC_ii[1:100,1])))
abline(h=median(abs(TC_ii[1:100,1])))
plot(abs(result_ad$A[1:100,1] - TC_ii[1:100,1]), type='l', zlim=c(0,3.5))
plot(abs(result_ad$A[1:100,1] - TC_ii[1:100,1]), type='l', ylim=c(0,3.5))
abline(h = mean(abs(result_ad$A[1:100,1] - TC_ii[1:100,1])))
abline(h = 0, lty=2)
abline(h=median(abs(TC_ii[1:100,1])), col='pink')
n1 <- n2 <- 100
p1 <- 0.5
p2 <- 0.25
X1 <- rbinom(1, n1, p1)
set.seed(123)
rbinom(1, n1, p1)
rbinom(1, n1, p1)
set.seed(123)
X1 <- rbinom(1, n1, p1)
set.seed(1232)
X2 <- rbinom(1, n2, p2)
X1
X2
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(1232)
(X2 <- rbinom(1, n2, p2))
nsim <- 10000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
hist((X1_sim/n1)/(X2_sim/n2))
hist((X1_sim/n1)/(X2_sim/n2), breaks=100)
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
hist((X1_sim/n1)/(X2_sim/n2), breaks=100)
hist((X1_sim/n1)/(X2_sim/n2), breaks=50)
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
p1_hat <- X1/n1
p2_hat <- X2/n2
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
p1_hat <- X1/n1
p2_hat <- X2/n2
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1_hat)
X2_sim[ii] <- rbinom(1, n2, p2_hat)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
SE <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/SE, breaks=50)
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50)
psi_var
p1*(1-p1)/n1 * (1/p2^2) + p2*(1-p2)/n2 * p1^2/p2^4
n1 <- n2 <- 10000
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(1232)
(X2 <- rbinom(1, n2, p2))
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple')
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple')
n1 <- n2 <- 100
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(1232)
(X2 <- rbinom(1, n2, p2))
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple')
n1 <- n2 <- 50
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(1232)
(X2 <- rbinom(1, n2, p2))
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=50, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple')
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=100, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple')
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple', lwd=2)
quantile(psi_sim, c(0.025, 0.975))
### Question 1
n1 <- n2 <- 50
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(1232)
(X2 <- rbinom(1, n2, p2))
# Simulate
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=100, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple', lwd=2)
quantile(psi_sim, c(0.025, 0.975))
nsim <- 100000
p1_hat <- X1/n1
p2_hat <- X2/n2
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1_hat)
X2_sim[ii] <- rbinom(1, n2, p2_hat)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
quantile(psi_sim, c(0.025, 0.975))
psi_hat <- (X1/n1)/(X2/n2)
z_alpha <- qnorm(0.975)
z_alpha
psi_hat + c(-1,1) * 1.96 * sqrt(psi_var)
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
psi_hat + c(-1,1) * 1.96 * sqrt(psi_var)
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=100, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple', lwd=2)
quantile(psi_sim, c(0.025, 0.975))
nsim <- 100000
p1_hat <- X1/n1
p2_hat <- X2/n2
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1_hat)
X2_sim[ii] <- rbinom(1, n2, p2_hat)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
quantile(psi_sim, c(0.025, 0.975))
set.seed(1234)
(X2 <- rbinom(1, n2, p2))
psi_hat <- (X1/n1)/(X2/n2)
X2
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
psi_hat + c(-1,1) * 1.96 * sqrt(psi_var)
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=100, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple', lwd=2)
quantile(psi_sim, c(0.025, 0.975))
set.seed(12345)
(X2 <- rbinom(1, n2, p2))
psi_hat <- (X1/n1)/(X2/n2)
# Simulate
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_var <- p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) )
psi_hat + c(-1,1) * 1.96 * sqrt(psi_var)
hist((psi_sim - p1/p2)/sqrt(psi_var), breaks=100, freq=FALSE)
lines(seq(-4,4,0.01), dnorm(seq(-4,4,0.01)), col='purple', lwd=2)
quantile(psi_sim, c(0.025, 0.975))
nsim <- 100000
p1_hat <- X1/n1
p2_hat <- X2/n2
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1_hat)
X2_sim[ii] <- rbinom(1, n2, p2_hat)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
hist(psi_sim, breaks=50)
quantile(psi_sim, c(0.025, 0.975))
quantile(psi_sim, c(0.05, 0.95))
alpha <- 0.1
z_alpha <- qnorm(1-alpha/2)
z_alpha
### Question 1
n1 <- n2 <- 50
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(12345)
(X2 <- rbinom(1, n2, p2))
# Part 1
nsim <- 100000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_SE <- sqrt(p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) ))
hist((psi_sim - p1/p2)/psi_SE, breaks=100, freq=FALSE)
lines(seq(-5,5,0.01), dnorm(seq(-5,5,0.01)), col='purple', lwd=2)
hist((psi_sim - p1/p2)/psi_SE, breaks=100, freq=FALSE, col='orange')
lines(seq(-5,5,0.01), dnorm(seq(-5,5,0.01)), col='purple', lwd=2)
nsim <- 10000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_SE <- sqrt(p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) ))
hist((psi_sim - p1/p2)/psi_SE, breaks=100, freq=FALSE, col='orange')
lines(seq(-5,5,0.01), dnorm(seq(-5,5,0.01)), col='purple', lwd=2)
nsim <- 10000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_SE <- sqrt(p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) ))
psi_norm <- (psi_sim - p1/p2)/psi_SE
hist(psi_norm, breaks=100, freq=FALSE, col='orange')
x_vals <- seq(-5,5,0.01)
lines(x_vals, dnorm(x_vals), col='purple', lwd=2)
tinytex::install_tinytex()
p1
p2
p1=X1/n1
p2=X2/n2
knitr::opts_chunk$set(echo = TRUE)
psi_SE <- sqrt(p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) ))
psi_hat + c(-1,1) * z_alpha * psi_SE
X2
set.seed(123456)
(X2 <- rbinom(1, n2, p2))
n1 <- n2 <- 50
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
set.seed(123456)
(X2 <- rbinom(1, n2, p2))
n1 <- n2 <- 50
p1 <- 0.5
p2 <- 0.25
set.seed(123)
(X1 <- rbinom(1, n1, p1))
p1_hat <- X1/n1
set.seed(123456)
(X2 <- rbinom(1, n2, p2))
p2_hat <- X2/n2
nsim <- 10000
X1_sim <- X2_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X1_sim[ii] <- rbinom(1, n1, p1)
X2_sim[ii] <- rbinom(1, n2, p2)
}
psi_sim <- (X1_sim/n1)/(X2_sim/n2)
psi_SE <- sqrt(p1_hat/p2_hat^2 * ( (1-p1_hat)/n1 + p2_hat*(1-p2_hat)*p1_hat/(n2*p2_hat^2) ))
psi_norm <- (psi_sim - p1/p2)/psi_SE
hist(psi_norm, breaks=100, freq=FALSE, col='orange')
# N(0,1) density
x_vals <- seq(-5,5,0.01)
lines(x_vals, dnorm(x_vals), col='purple', lwd=2)
alpha <- 0.1
z_alpha <- qnorm(1-alpha/2)
(psi_hat <- (X1/n1)/(X2/n2))
psi_hat + c(-1,1) * z_alpha * psi_SE
set.seed(1234567)
(X2 <- rbinom(1, n2, p2))
set.seed(12)
(X2 <- rbinom(1, n2, p2))
set.seed(123)
(X2 <- rbinom(1, n2, p2))
set.seed(1234)
(X2 <- rbinom(1, n2, p2))
set.seed(1235)
(X2 <- rbinom(1, n2, p2))
set.seed(1236)
(X2 <- rbinom(1, n2, p2))
set.seed(1237)
(X2 <- rbinom(1, n2, p2))
set.seed(12378)
(X2 <- rbinom(1, n2, p2))
set.seed(123789)
(X2 <- rbinom(1, n2, p2))
set.seed(1236789)
(X2 <- rbinom(1, n2, p2))
set.seed(12356789)
(X2 <- rbinom(1, n2, p2))
psi_SE_fun <- function(X1, n1, X2, n2){
p1 <- X1/n1
p2 <- X2/n2
sqrt(p1/p2^2 * ( (1-p1)/n1 + p2*(1-p2)*p1/(n2*p2^2) ))
}
```{r}
p0 = 0.5
p = 0.5
n <- 50
X <- rbinom(n, p)
X <- rbinom(1, n, p)
X
Wald_test_fun <- function(X, n, p0, alpha){
p_hat <- X/n
p_hat_SE <- sqrt(p_hat*(p_hat)/n)
W <- (p_hat - p0)/p_hat_SE
}
Wald_test_fun <- function(X, n, p0, alpha){
p_hat <- X/n
p_hat_SE <- sqrt(p_hat*(p_hat)/n)
return(W <- (p_hat - p0)/p_hat_SE)
}
alpha <- 0.05
W <- Wald_test_fun(X, n, p0, alpha)
alpha <- 0.05
z_alpha <- qnorm(1-alpha/2)
z_alpha
abs(W) > z_alpha
W
set.seed(54321)
X <- rbinom(1, n, p)
alpha <- 0.05
W <- Wald_test_fun(X, n, p0, alpha)
(W <- Wald_test_fun(X, n, p0, alpha))
LRT_test_fun <- function(X, n, p0, alpha){
p_hat <- X/n
return(Chisq <- 2*X*log(p_hat/p0) + 2*(n-X)*log((1-p_hat)/(1-p0)))
}
(LRT_test_fun(X, n, p0, alpha=0.05)) #user-defined function to compute the Chi-sq test statistic
qchisq(0.95, df=1)
1.96^2
Wald_test_fun <- function(X, n, p0){
p_hat <- X/n
p_hat_SE <- sqrt(p_hat*(p_hat)/n)
return(W <- (p_hat - p0)/p_hat_SE)
}
LRT_test_fun <- function(X, n, p0){
p_hat <- X/n
return(Chisq <- 2*X*log(p_hat/p0) + 2*(n-X)*log((1-p_hat)/(1-p0)))
}
nsim <- 100000
Wald_sim <- LRT_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X <- rbinom(1, n, p0)
W_sim[ii] <- Wald_test_fun(X, n, p0) #user-defined function to compute W
LRT_sim[ii] <- LRT_test_fun(X, n, p0) #user-defined function to compute lambda
}
for(ii in 1:nsim){
X <- rbinom(1, n, p0)
Wald_sim[ii] <- Wald_test_fun(X, n, p0) #user-defined function to compute W
LRT_sim[ii] <- LRT_test_fun(X, n, p0) #user-defined function to compute lambda
}
hist(Wald_sim)
hist(Wald_sim, breaks=100)
hist(Wald_sim, breaks=50)
hist(Wald_sim, breaks=30)
hist(Wald_sim, breaks=25)
hist(40)
hist(Wald_sim, breaks=40)
hist(Wald_sim, breaks=70)
p0 = 0.5
p = 0.5
n <- 50
set.seed(54321)
X <- rbinom(1, n, p)
(W <- Wald_test_fun(X, n, p0)) #user-defined function to compute W
(lambda <- LRT_test_fun(X, n, p0)) #user-defined function to compute lambda
mean(abs(Wald_sim) > abs(W))
mean(abs(Wald_sim) > 1.96)
mean(abs(Wald_sim) > qnorm(0.975))
mean(LRT_sim > qchisq(0.95,1))
df <- 1
qchisq(0.95,df)
hist(LRT_sim, breaks=70, freq=FALSE)
lines(x_vals, dchisq(x_vals, df), col='purple', lwd=2)
hist(LRT_sim, breaks=70, freq=FALSE)
# Chi-squared density
x_vals <- seq(0,20,0.01)
lines(x_vals, dchisq(x_vals, df), col='purple', lwd=2)
p0 = 0.5
p = 0.5
n <- 100
set.seed(54321)
X <- rbinom(1, n, p)
nsim <- 100000
Wald_sim <- LRT_sim <- rep(NA, nsim)
for(ii in 1:nsim){
X <- rbinom(1, n, p0)
Wald_sim[ii] <- Wald_test_fun(X, n, p0) #user-defined function to compute W
LRT_sim[ii] <- LRT_test_fun(X, n, p0) #user-defined function to compute lambda
}
mean(abs(Wald_sim) > qnorm(0.975))
mean(LRT_sim > qchisq(0.95,df)) #df is user-defined
hist(Wald_sim, breaks=70, freq=FALSE)
# N(0,1) density
x_vals <- seq(-5,5,0.01)
lines(x_vals, dnorm(x_vals), col='purple', lwd=2)
hist(Wald_sim, breaks=70, freq=FALSE)
# N(0,1) density
x_vals <- seq(-5,5,0.01)
lines(x_vals, dnorm(x_vals), col='purple', lwd=2)
hist(LRT_sim, breaks=70, freq=FALSE)
# Chi-squared density
x_vals <- seq(0,20,0.01)
lines(x_vals, dchisq(x_vals, df), col='purple', lwd=2)
hist(LRT_sim, breaks=30, freq=FALSE)
# Chi-squared density
x_vals <- seq(0,20,0.01)
lines(x_vals, dchisq(x_vals, df), col='purple', lwd=2)
hist(Wald_sim, breaks=30, freq=FALSE)
# N(0,1) density
x_vals <- seq(-5,5,0.01)
lines(x_vals, dnorm(x_vals), col='purple', lwd=2)
